# Playbook: global_demand_down
# Triggers when a global demand delta <= -2% is detected.
# LLM fills parameters, PolicyEngine enforces bounds and approvals.

playbook: global_demand_down
triggers:
  - event_type: ForecastDeltaDetected
    where:
      level: global
      operator: lte
      value: -0.02

guards:
  approvals:
    required_roles: [FinanceController, VP_Supply]

parameters:
  elasticity_inventory_default: 1.0
  po_trim_bounds_pct: { min: 0.01, max: 0.05 }
  marketing_realloc_bounds_pct: { min: 0.05, max: 0.20 }
  sales_quota_bounds_pct: { min: -0.05, max: 0.00 }

actions:
  - function: Inventory
    type: adjust_po
    params:
      reduction_pct_formula: "clip(abs(delta_pct) * elasticity_inventory_default, po_trim_bounds_pct.min, po_trim_bounds_pct.max)"
  - function: Marketing
    type: realloc_budget
    params:
      from: prospecting
      to: retention
      amount_pct_formula: "clip(0.5 * abs(delta_pct), marketing_realloc_bounds_pct.min, marketing_realloc_bounds_pct.max)"
  - function: Sales
    type: reset_quota
    params:
      adjustment_pct_formula: "clip(delta_pct, sales_quota_bounds_pct.min, sales_quota_bounds_pct.max)"
  - function: Finance
    type: update_cash_flow
    params:
      scenario: "Base-{delta_pct}"
