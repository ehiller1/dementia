# Playbook: sku_demand_down
# Triggers when a specific SKU demand delta <= -10% is detected.
# Produces targeted actions bounded by lead times, service levels, and substitution rules.

playbook: sku_demand_down
triggers:
  - event_type: ForecastDeltaDetected
    where:
      level: sku
      operator: lte
      value: -0.10

guards:
  approvals:
    required_roles: [CategoryManager, VP_Supply]

parameters:
  po_reduction_bounds_pct: { min: 0.05, max: 0.30 }
  promo_adjust_bounds_pct: { min: -0.20, max: 0.00 }
  price_move_bounds_pct: { min: -0.10, max: 0.00 }
  min_weeks_cover_policy: 6

actions:
  - function: Inventory
    type: adjust_po
    params:
      target: sku
      reduction_pct_formula: "clip(abs(delta_pct), po_reduction_bounds_pct.min, po_reduction_bounds_pct.max)"
      respect_lead_time: true
  - function: Marketing
    type: adjust_promo
    params:
      target: sku
      lift_adjustment_pct_formula: "clip(0.5 * delta_pct, promo_adjust_bounds_pct.min, promo_adjust_bounds_pct.max)"
  - function: Sales
    type: notify_key_accounts
    params:
      target: sku
      message_template: "Demand softening for {sku}; expect allocation adjustments."
  - function: Inventory
    type: propose_substitution
    params:
      from_sku: "{sku}"
      to_sku_strategy: "nearest_substitute_by_margin"
  - function: Pricing
    type: evaluate_price_move
    params:
      candidate_move_pct_range: [price_move_bounds_pct.min, price_move_bounds_pct.max]
